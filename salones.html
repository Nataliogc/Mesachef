<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>MesaChef · Salones</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#2563eb" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="manifest" href="manifest.json" />

    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/restaurante.css" />

    <style>
        /* Buttons Logic */
        .btn-report {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            font-size: 13px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            background: white;
            cursor: pointer;
            color: #374151;
            text-decoration: none;
        }

        .btn-report:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        /* Grid Overrides */
        .slot-jornada {
            min-height: 80px;
            position: relative;
            /* For absolutely positioned add button if we wanted, or flex centered */
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        /* Hover effect for add button */
        .slot-jornada:hover .btn-add-slot {
            opacity: 1;
        }

        .btn-add-slot {
            opacity: 0.5;
            /* Subtle by default */
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #eff6ff;
            color: #2563eb;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin: auto;
            /* Center in slot */
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-add-slot:hover {
            opacity: 1;
            background: #2563eb;
            color: white;
            transform: scale(1.1);
        }

        .reserva-completa {
            background-color: #dbeafe;
            border-left: 3px solid #2563eb;
        }

        /* Modal Concepts Table */
        .concepts-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 13px;
        }

        .concepts-table th {
            text-align: left;
            color: #64748b;
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
            padding: 8px 4px;
            border-bottom: 1px solid #e2e8f0;
        }

        .concepts-table td {
            padding: 4px;
        }

        .input-concept {
            width: 100%;
            padding: 6px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }

        .input-uds {
            width: 60px;
            padding: 6px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            text-align: center;
        }

        .input-price {
            width: 80px;
            padding: 6px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            text-align: right;
        }

        .cell-total {
            width: 80px;
            text-align: right;
            font-weight: 600;
            color: #1e293b;
        }

        .btn-del-row {
            color: #ef4444;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 0 8px;
        }

        .btn-add-line {
            margin-top: 10px;
            background: none;
            border: none;
            color: #475569;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn-add-line:hover {
            color: #1e293b;
        }
    </style>
</head>

<body class="app-body">
    <div class="mc-shell">
        <header class="topbar">
            <div class="topbar-left">
                <span class="breadcrumb"><a href="index.html"
                        style="text-decoration:none; color:inherit;">Inicio</a></span>
                <span class="crumb-sep"> &middot; </span>
                <span id="tituloHotel" class="breadcrumb strong">Salas & Eventos</span>
                <span id="estadoConexion" class="estado-conexion">Conectando...</span>
            </div>
            <div class="topbar-right">
                <div class="search-box">
                    <input type="text" id="txtBuscar" placeholder="Buscar evento..." />
                </div>
                <button id="btnNuevoEvento" class="btn-primary">+ Nuevo Evento</button>
            </div>
        </header>

        <div class="planning-controls-bar">
            <div class="planning-nav">
                <button id="btnPrev" class="btn-icon" title="Semana anterior">&larr;</button>
                <input type="date" id="inputSemana" class="input-date" style="width:140px;" />
                <button id="btnNext" class="btn-icon" title="Semana siguiente">&rarr;</button>

                <button id="btnReporteSemana" class="btn-report" title="Imprimir semana">
                    <span>&#x1F5A8;</span> <span>Semana</span>
                </button>
            </div>
        </div>

        <main class="main-content">
            <div id="gridSalones" class="planning-container">
                <!-- JS renders grid -->
            </div>
        </main>
    </div>

    <!-- MODAL EVENTO (Diseño Ficha) -->
    <div id="modalEvento" class="modal-overlay hidden">
        <div class="modal-card" style="max-width: 700px;"> <!-- Wider for table -->
            <div class="modal-header">
                <h3 id="tituloModalEvento">Ficha Evento</h3>
                <button id="btnCerrarModal" class="btn-close">&times;</button>
            </div>
            <form id="formEvento">
                <div class="modal-body">
                    <!-- Ficha Header info -->
                    <div class="form-row">
                        <div class="form-group" style="flex:0 0 140px;">
                            <label class="modal-label">FECHA</label>
                            <input id="campoFecha" type="date" class="modal-input" required />
                        </div>
                        <div class="form-group flex-1">
                            <label class="modal-label">NOMBRE / EVENTO</label>
                            <input id="campoNombre" type="text" class="modal-input" placeholder="Ej: Boda García"
                                required />
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group flex-1">
                            <label class="modal-label">SALÓN</label>
                            <select id="campoSalon" class="modal-select"></select>
                        </div>
                        <div class="form-group flex-1">
                            <label class="modal-label">JORNADA</label>
                            <select id="campoTurno" class="modal-select">
                                <option value="mañana">Mañana (Media)</option>
                                <option value="tarde">Tarde (Media)</option>
                                <option value="completa">Jornada Completa</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex:0 0 120px;">
                            <label class="modal-label">ESTADO</label>
                            <!-- Simplified status for Ficha view -->
                            <select id="campoEstado" class="modal-select">
                                <option value="pendiente">Pendiente</option>
                                <option value="confirmada">Confirmada</option>
                                <option value="anulada">Anulada</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group flex-1">
                            <label class="modal-label">MONTAJE</label>
                            <select id="campoMontaje" class="modal-select"></select>
                        </div>
                        <div class="form-group" style="flex:0 0 80px;">
                            <label class="modal-label">PAX</label>
                            <input id="campoPax" type="number" class="modal-input" />
                        </div>
                    </div>

                    <!-- Conceptos Table -->
                    <div
                        style="background:#f8fafc; padding:10px; border-radius:6px; margin-top:10px; border:1px solid #e2e8f0;">
                        <table class="concepts-table">
                            <thead>
                                <tr>
                                    <th>CONCEPTO</th>
                                    <th>UDS</th>
                                    <th>PRECIO</th>
                                    <th>TOTAL</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="tbodyConceptos">
                                <!-- Rows rendered by JS -->
                            </tbody>
                        </table>
                        <button type="button" id="btnAddLine" class="btn-add-line">+ AÑADIR LÍNEA</button>

                        <div style="text-align:right; margin-top:10px; font-weight:700; font-size:14px; color:#1e293b;">
                            TOTAL: <span id="lblTotalGeneral">0.00€</span>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:15px;">
                        <label class="modal-label">NOTAS INTERNAS</label>
                        <textarea id="campoNotas" class="modal-textarea" rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnCancelarEvento" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-primary">GUARDAR</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script src="js/firebase-init.js"></script>
    <script src="js/app-common.js"></script>
    <script src="js/salones.js"></script>
    <script>
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
    </script>
</body>

</html>