<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Gestor de Eventos ‚Äì MesaChef</title>

    <link rel="icon" type="image/png" href="mesa-chef-192.png">
    <link rel="apple-touch-icon" href="mesa-chef-512.png">
    <meta name="theme-color" content="#263238">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --primary: #263238;
            --accent: #546e7a;
            --bg-body: #f0f2f5;
            --surface: #ffffff;
            --border: #dfe3e8;
            --purple-ai: #8b5cf6; /* Color exacto bot√≥n IA original */
        }
        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        body { margin: 0; background: var(--bg-body); color: #1a1a1a; font-size: 13px; -webkit-tap-highlight-color: transparent; }

        /* --- LANDING --- */
        #landingPage { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #e0e7ff 0%, #f3f4f6 100%); padding: 20px; }
        .landing-container { background: var(--surface); border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); padding: 40px; max-width: 900px; width: 100%; text-align: center; }
        .app-logo-big { width: 120px; height: 120px; object-fit: cover; border-radius: 24px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); margin-bottom: 10px; }
        .hotel-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        .h-card { border: 1px solid var(--border); border-radius: 20px; padding: 24px; cursor: pointer; transition: 0.2s; background: #fff; display: flex; flex-direction: column; align-items: center; }
        .h-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.06); }
        .h-card img { max-height: 50px; margin-bottom: 15px; object-fit: contain; }
        .h-tag { background: #f3f4f6; color: #4b5563; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; }

        /* --- HEADER --- */
        #appContainer { display: none; min-height: 100vh; flex-direction: column; }
        .app-header { background: #fff; padding: 10px 24px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; flex-wrap: wrap; gap:15px; }
        .header-left { display: flex; align-items: center; gap: 14px; }
        .btn-back { width: 34px; height: 34px; border-radius: 50%; border: 1px solid #cfd8dc; background: #f5f5f5; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; }
        .header-title { font-size: 18px; font-weight: 700; color: var(--primary); margin: 0; }
        #headerLogo { max-height: 36px; object-fit: contain; }
        
        .connection-badge { display: inline-flex; align-items: center; gap: 6px; padding: 3px 10px; border-radius: 999px; font-size: 11px; font-weight: 600; border: 1px solid transparent; white-space: nowrap; }
        .status-online { background: #e8f5e9; color: #1b5e20; border-color: #a5d6a7; } 
        .status-offline { background: #ffebee; color: #c62828; border-color: #ef9a9a; }

        .module-tabs { display: flex; gap: 6px; background: #f5f5f5; padding: 4px; border-radius: 999px; }
        .tab-btn { border: none; background: transparent; padding: 6px 14px; border-radius: 999px; font-size: 12px; cursor: pointer; display: inline-flex; align-items: center; gap: 4px; color: #37474f; }
        .tab-btn.active { background: var(--primary); color: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }

        .controls-bar { padding: 15px 24px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: space-between; }
        .table-wrapper { margin: 0 20px 20px; background: #fff; border-radius: 12px; box-shadow: var(--shadow); overflow: auto; flex: 1; }
        
        table { border-collapse: collapse; width: 100%; }
        th { background: #f8fafc; padding: 12px; text-align: left; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 10; font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 600; }
        td { border-bottom: 1px solid #f1f5f9; vertical-align: top; }

        /* CELDAS CALENDARIO */
        .split-cell { display: flex; flex-direction: column; height: 90px; width: 100%; position: relative; }
        .split-zone { flex: 1; border-bottom: 1px dotted #e2e8f0; display: flex; align-items: center; padding: 0 4px; cursor: pointer; transition: 0.1s; }
        .split-zone:hover { background: #f8fafc; }
        
        .evt-full-day { position: absolute; top: 2px; left: 2px; right: 2px; bottom: 2px; background: #dbeafe; color: #1e40af; border-left: 4px solid #2563eb; border-radius: 4px; padding: 6px; font-size: 11px; z-index: 2; overflow: hidden; }
        .evt-part { width: 100%; height: 90%; border-radius: 4px; padding: 4px 6px; font-size: 11px; display: flex; align-items: center; overflow: hidden; white-space: nowrap; }
        .evt-manana { background: #e0f2fe; color: #0369a1; border-left: 3px solid #0ea5e9; }
        .evt-tarde { background: #f3e8ff; color: #6b21a8; border-left: 3px solid #d8b4fe; }
        .evt-confirmado { background: #dcfce7 !important; color: #166534 !important; border-left-color: #22c55e !important; }
        .evt-gran { background: #fce7f3; color: #9d174d; border-left: 3px solid #be185d; }

        /* LISTADOS */
        .budget-table { width: 100%; border-collapse: collapse; }
        .budget-row { border-bottom: 1px solid #f1f5f9; cursor: pointer; }
        .budget-row:hover { background: #f8fafc; }
        .budget-row td { padding: 8px 10px; }
        .badge { display: inline-flex; padding: 2px 10px; border-radius: 99px; font-size: 11px; font-weight: 600; text-transform: capitalize; }
        .st-confirmado { background: #dcfce7; color: #166534; border: 1px solid #22c55e; }
        .st-pendiente { background: #ffedd5; color: #9a3412; border: 1px solid #f97316; }
        .st-anulado { background: #fee2e2; color: #991b1b; border: 1px solid #ef4444; }

        /* --- MODAL ORIGINAL --- */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 200; justify-content: center; align-items: center; padding: 20px;}
        .modal-content { background: #fff; width: 100%; max-width: 900px; max-height: 90vh; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .modal-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: #fff; border-bottom: 1px solid #eee; }
        .modal-body { padding: 20px; overflow-y: auto; background: #fff; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid #e2e8f0; display: flex; align-items: center; gap: 10px; background: #f8fafc; }

        /* BARRA IA & BOTONES ORIGINALES */
        .ai-toolbar { display: flex; gap: 8px; padding: 8px; background: #f5f3ff; border-radius: 8px; border: 1px dashed #8b5cf6; margin-bottom: 15px; align-items: center; }
        .ai-label { font-size: 11px; font-weight: 700; color: #6b21a8; margin-right: auto; text-transform: uppercase; display: flex; align-items: center; gap: 4px; }
        
        .btn-ai { background: linear-gradient(135deg, #a855f7 0%, #6366f1 100%); color: #fff; padding: 5px 12px; border-radius: 99px; font-size: 11px; border:none; cursor:pointer; box-shadow: 0 2px 5px rgba(124, 58, 237, 0.3); font-weight: 600; }
        .btn-ai:hover { transform: translateY(-1px); filter: brightness(1.1); }

        .form-row { display: flex; gap: 15px; margin-bottom: 15px; }
        .form-group { flex: 1; display: flex; flex-direction: column; }
        label { font-size: 11px; text-transform: uppercase; color: #64748b; margin-bottom: 4px; font-weight: 600; }
        
        /* INPUTS ORIGINALES (REDONDEADOS) */
        input, select, textarea { padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; width: 100%; }
        input:focus, select:focus { outline:none; border-color: #8b5cf6; }

        /* TABLA SERVICIOS (ESTILO ORIGINAL IMAGEN 3) */
        .svc-table { width: 100%; border-collapse: separate; border-spacing: 0 4px; margin-top: 10px; }
        .svc-table th { background: #f1f5f9; padding: 8px; border-bottom: 1px solid #cbd5e1; text-align: left; font-weight: 700; color: #475569; }
        .svc-table td { padding: 2px 4px; vertical-align: middle; }
        
        /* INPUTS TABLA (BLANCOS Y REDONDEADOS) */
        .svc-input { border: 1px solid #e2e8f0; padding: 8px; border-radius: 6px; background: #fff; text-align: center; height: 36px; }
        .s-desc { text-align: left !important; }

        .btn-add-row { margin-top: 8px; background: #f0f9ff; border: 1px dashed #bae6fd; color: #0284c7; padding: 10px; border-radius: 8px; width: 100%; cursor:pointer; font-weight: 600; }
        
        /* BOTONES PIE DE P√ÅGINA (IMAGEN 4) */
        .btn-primary { background: #0f172a; color: #fff; padding: 10px 20px; border-radius: 8px; font-weight: 600; } /* Negro */
        .btn-secondary { background: #fff; border: 1px solid #cbd5e1; color: #475569; padding: 10px 18px; border-radius: 8px; font-weight: 600; } /* Blanco */
        .btn-confirm { background: #10b981; color: white; padding: 10px 20px; border-radius: 8px; font-weight: 600; border:none; } /* Verde */
        .btn-anular { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; padding: 10px 18px; border-radius: 8px; font-weight: 600; } /* Rojo */
        .btn-email { background: #8b5cf6; color: white; padding: 10px 18px; border-radius: 8px; font-weight: 600; border:none; display: flex; align-items: center; gap: 5px; } /* Morado */

        /* INFO BOX */
        .info-box { background: #f1f5f9; padding: 8px; border-radius: 6px; border: 1px dashed #cbd5e1; display: flex; gap: 15px; align-items: center; margin-bottom: 10px; }
        
        #aiResponseModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 300; justify-content: center; align-items: center; }
        .ai-box { background: white; padding: 20px; border-radius: 12px; width: 500px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

    <div id="landingPage">
        <div class="landing-container">
            <div class="landing-header">
               <img src="mesa-chef-512.png" alt="Logo" class="app-logo-big">
                <h1 style="margin:0; font-size:24px; color:#1f2937;">RESERVAS SALAS Y RESTAURANTE</h1>
                <p style="color:#666;">Gesti√≥n unificada para <strong>Sercotel Guadiana</strong> y <strong>Cumbria Spa&Hotel</strong>.</p>
                <div style="background:#d1fae5; color:#065f46; padding:4px 10px; border-radius:10px; display:inline-block; font-size:11px;">‚óè v17.0 ORIGINAL RESTORED</div>
            </div>
            <div class="hotel-grid">
                <div class="h-card" onclick="initApp('Guadiana')">
                    <img src="Img/logo-guadiana.svg" alt="Logo Guadiana" onerror="this.style.display='none'">
                    <h3>Sercotel Guadiana</h3>
                    <div class="h-tag">üèõÔ∏è Ciudad Real ¬∑ Centro</div>
                </div>
                <div class="h-card" onclick="initApp('Cumbria')">
                    <img src="Img/logo-cumbria.svg" alt="Logo Cumbria" onerror="this.style.display='none'">
                    <h3>Cumbria Spa&Hotel</h3>
                    <div class="h-tag">üåÑ Ciudad Real ¬∑ Zona Norte</div>
                </div>
            </div>
        </div>
    </div>

    <div id="appContainer">
        <div class="app-header">
            <div class="header-left">
                <button class="btn-back" onclick="location.reload()">‚¨Ö</button>
                <h2 id="tituloHotelActual" class="header-title">Hotel</h2>
                <img id="headerLogo" style="height:30px; margin-left:10px;" />
                <div class="connection-badge status-offline" id="statusBadge">
                    <span class="status-dot"></span><span id="statusText">Conectando...</span>
                </div>
            </div>
            <div class="header-right">
                <div class="module-tabs">
                    <button class="tab-btn active" onclick="setModulo('eventos')" id="btnModEventos">üìÖ Salones</button>
                    <button class="tab-btn" onclick="setModulo('restaurante')" id="btnModRest">üç¥ Restaurante</button>
                    <button class="tab-btn" onclick="setModulo('presupuestos')" id="btnModPpto">üìÑ Presupuestos</button>
                    <button class="tab-btn" onclick="setModulo('grandes_eventos')" id="btnModGran">üéâ Grandes Eventos</button>
                </div>
                <a href="admin.html" class="btn-secondary" style="text-decoration:none; display:inline-flex; align-items:center; padding: 6px 12px; font-size: 12px;">‚öôÔ∏è Config</a>
            </div>
        </div>

        <div class="controls-bar">
            <div class="left-controls">
                <input type="date" id="fechaVista" onchange="render()" />
                <select id="filtroEstado" onchange="render()">
                    <option value="todos">Ver activos</option>
                    <option value="pendiente">‚è≥ Pendientes</option>
                    <option value="confirmado">‚úÖ Confirmados</option>
                    <option value="anulado">‚ùå Anulados</option>
                </select>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn-secondary" id="btnReporte" onclick="alert('Informe listo')">üñ®Ô∏è Informe</button>
                <button class="btn-primary" id="btnNuevoPrincipal" onclick="nuevoGeneral()">+ Nuevo</button>
            </div>
        </div>

        <div class="table-wrapper">
            <table id="mainTable"><thead id="tableHead"></thead><tbody id="tableBody"></tbody></table>
            <div id="presupuestosContainer" style="display: none">
                <table class="budget-table">
                    <thead>
                        <tr><th style="width: 120px">Fecha</th><th>Cliente</th><th>Sal√≥n</th><th style="width: 150px">Ref</th><th style="width: 120px">Estado</th><th style="width: 120px; text-align: right">Total</th></tr>
                    </thead>
                    <tbody id="budgetBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalFicha">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ficha</h3>
                <button onclick="cerrarModal()" style="border:none; background:none; font-size:20px; cursor:pointer;">√ó</button>
            </div>

            <div class="modal-body">
                <input type="hidden" id="dataId"><input type="hidden" id="dataType"><input type="hidden" id="refPresupuesto">

                <div class="ai-toolbar" id="aiToolbar">
                    <span class="ai-label">‚ú® Herramientas IA</span>
                    <button class="btn-ai" onclick="generarMenuIA()">üçΩÔ∏è Men√∫</button>
                    <button class="btn-ai" onclick="checklistIA()">‚úÖ Checklist</button>
                    <button class="btn-ai" onclick="auditarIA()" style="background:#f59e0b;">‚ö†Ô∏è Auditar</button>
                </div>

                <div class="form-row" style="background: #f8fafc; padding: 10px; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <div class="form-group" id="grpFechaUnica">
                        <label>Fecha</label><input type="date" id="inpFecha" />
                    </div>
                    <div class="form-group" id="grpRangoFechas" style="display: none">
                        <div style="display:flex; gap: 10px;">
                            <div style="flex:1"><label>Desde</label><input type="date" id="inpFechaDesde" /></div>
                            <div style="flex:1"><label>Hasta</label><input type="date" id="inpFechaHasta" /></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Espacio / Sal√≥n</label><select id="inpSalon"></select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex: 2">
                        <label>Cliente / Evento</label>
                        <input type="text" id="inpNombre" placeholder="Nombre del cliente..." oninput="document.getElementById('modalTitle').innerText = this.value || 'Ficha'" />
                    </div>
                    <div class="form-group"><label>Tel√©fono</label><input type="text" id="inpTel" /></div>
                    <div class="form-group"><label>Email</label><input type="text" id="inpEmail" /></div>
                </div>

                <div class="form-row" id="blockRestaurante" style="display: none; background: #fffbeb; padding: 6px; border-radius: 8px; border: 1px solid #fcd34d;">
                    <div style="display:flex; gap:10px; width:100%;">
                        <div class="form-group"><label>Hora</label><input type="time" id="inpHora" /></div>
                        <div class="form-group"><label>‚Ç¨ Men√∫</label><input type="number" id="inpPrecioMenu" /></div>
                        <div class="form-group"><label>Pax</label><input type="number" id="inpPaxRest" /></div>
                        <div class="form-group"><label>Turno</label><select id="inpTurno"><option value="manana">‚òÄÔ∏è Almuerzo</option><option value="tarde">üåô Cena</option></select></div>
                        <div class="form-group"><label>Estado</label><select id="inpEstadoRest"><option value="confirmado">‚úÖ Confirmada</option><option value="lista_espera">‚è≥ Lista de Espera</option></select></div>
                    </div>
                </div>

                <div id="blockEventos">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Estado</label>
                            <select id="inpEstadoEvento">
                                <option value="pendiente">‚è≥ Pendiente</option>
                                <option value="confirmado">‚úÖ Confirmado</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Jornada</label><select id="inpTurnoEvento"><option value="dia_completo">Todo el d√≠a</option><option value="manana">‚òÄÔ∏è Ma√±ana</option><option value="tarde">üåô Tarde</option></select></div>
                        <div class="form-group"><label>Montaje</label><select id="inpMontaje"><option>Banquete</option><option>Escuela</option><option>Teatro</option><option>C√≥ctel</option><option>U</option></select></div>
                        <div class="form-group"><label>Pax A.</label><input type="number" id="inpPaxA" style="width:60px" /></div>
                        <div class="form-group"><label>Pax N.</label><input type="number" id="inpPaxN" style="width:60px" /></div>
                    </div>
                    
                    <div class="form-row" style="background: #f1f5f9; padding: 8px; border-radius: 6px; border: 1px dashed #cbd5e1;">
                        <div class="form-group"><label>Hora Inicio</label><input type="time" id="inpHoraInicio" /></div>
                        <div class="form-group"><label>Hora Fin</label><input type="time" id="inpHoraFin" /></div>
                        <div style="font-size:11px; color:#666; flex:2; display:flex; align-items:center">* Horario orientativo</div>
                    </div>

                    <div style="margin-top: 15px; border-top:1px solid #e2e8f0; padding-top:10px;">
                        <label style="color: var(--primary); font-weight: 700;">DESGLOSE / SERVICIOS</label>
                        <table class="svc-table">
                            <thead><tr><th width="120">Fecha</th><th>Concepto</th><th width="50">Uds</th><th width="80">Precio</th><th width="80">Total</th><th width="20"></th></tr></thead>
                            <tbody id="bodyServicios"></tbody>
                        </table>
                        <button class="btn-add-row" onclick="addServiceRow()">+ A√±adir l√≠nea</button>
                        <div style="text-align: right; font-size: 16px; font-weight: 700; margin-top: 10px;">TOTAL: <span id="totalAmount">0.00</span> ‚Ç¨</div>
                    </div>
                </div>

                <div id="blockGran" style="display:none; background:#fdf2f8; padding:10px; border-radius:8px; border:1px solid #fbcfe8;">
                    <div class="form-row">
                        <div class="form-group"><label>Aforo</label><input type="number" id="inpAforo" oninput="calcGran()"></div>
                        <div class="form-group"><label>Precio Std</label><input type="number" id="inpPrcStd" onchange="aplicarStd()"></div>
                        <div class="form-group"><label>Estado</label><select id="inpEstadoGran"><option value="abierto">üü¢ Abierto</option><option value="cerrado">üî¥ Cerrado</option></select></div>
                    </div>
                    <div style="font-weight:bold; margin-bottom:5px; font-size:12px;">
                        Pax: <span id="gPax">0</span> | Total: <span id="gTot">0</span>‚Ç¨ | Pendiente: <span id="gPend" style="color:red">0</span>‚Ç¨
                    </div>
                    <table class="svc-table">
                        <thead><tr><th>Mesa</th><th>Nombre</th><th>Pax</th><th>Precio</th><th>Pagado</th><th></th></tr></thead>
                        <tbody id="bodyPart"></tbody>
                    </table>
                    <button class="btn-add-row" onclick="addPart()">+ A√±adir Participante</button>
                </div>

                <div class="form-row" style="margin-top: 15px">
                    <div class="form-group"><label>Nota Interna</label><textarea id="inpNotas" rows="2"></textarea></div>
                    <div class="form-group">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <label style="color:#2563eb;">Nota para Cliente (PDF)</label>
                            <button class="btn-ai" onclick="mejorarNotaIA()" style="padding:2px 8px; font-size:10px;">‚ú® Mejorar</button>
                        </div>
                        <textarea id="inpNotaCliente" rows="2"></textarea>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-email" id="btnEmail" onclick="redactarEmailIA()" style="display:none;">üìß Email Cliente</button>
                <button class="btn-secondary" id="btnPdf" onclick="imprimirPDF()" style="display:none;">üìÑ PDF</button>
                
                <div style="flex: 1"></div>
                
                <button class="btn-confirm" id="btnConfirmarPpto" onclick="confirmarPresupuesto()" style="display:none;">‚úÖ Confirmar</button>
                <button class="btn-anular" id="btnAnular" onclick="anularFicha()">Anular</button>
                <button class="btn-primary" onclick="guardarFicha()">GUARDAR</button>
            </div>
        </div>
    </div>

    <div id="aiResponseModal">
        <div class="ai-box">
            <h3>ü§ñ Respuesta IA</h3>
            <textarea id="aiOutput" style="width:100%; height:200px; padding:10px; border:1px solid #cbd5e1; border-radius:6px;"></textarea>
            <div style="text-align:right; margin-top:10px;">
                <button class="btn-secondary" onclick="document.getElementById('aiResponseModal').style.display='none'">Cerrar</button>
                <button class="btn-primary" onclick="copiarAI()">Copiar</button>
            </div>
        </div>
    </div>

<script>
    const apiKey = "AIzaSyDnJMniLswGjpysPHiH3n3L6EpJyCkbS4E"; 
    const firebaseConfig = { apiKey: "AIzaSyBAK0sGUYpV8KHy1KwIdNRLtHlq5LT3Vwg", authDomain: "gestionsalones-bba4b.firebaseapp.com", projectId: "gestionsalones-bba4b", storageBucket: "gestionsalones-bba4b.firebasestorage.app", messagingSenderId: "860164285474", appId: "1:860164285474:web:ff995e88093e5aa5eb167b" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentHotel = null, currentModule = "eventos", dataCache = [], salonesConfig = {Guadiana:[], Cumbria:[], horarios:{}};

    function initApp(h) {
        currentHotel = h;
        document.getElementById("tituloHotelActual").innerText = h;
        document.getElementById("headerLogo").src = h==="Guadiana" ? "Img/logo-guadiana.svg" : "Img/logo-cumbria.svg";
        document.getElementById("landingPage").style.display = "none";
        document.getElementById("appContainer").style.display = "block";
        document.getElementById("fechaVista").valueAsDate = new Date();
        
        db.collection("master_data").doc("CONFIG_SALONES").onSnapshot(doc => { if(doc.exists) salonesConfig = doc.data(); render(); });
        cargarDatos();
    }

    function cargarDatos() {
        db.collection("master_data").onSnapshot(snap => {
            document.getElementById("statusBadge").classList.add("status-online");
            document.getElementById("statusText").innerText = "Conectado";
            dataCache = [];
            snap.forEach(d => { if(d.id!=="CONFIG_SALONES") dataCache.push({id:d.id, ...d.data()}); });
            render();
        });
    }

    function setModulo(m) {
        currentModule = m;
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        if(m==="eventos") document.getElementById("btnModEventos").classList.add("active");
        if(m==="restaurante") document.getElementById("btnModRest").classList.add("active");
        if(m==="presupuestos") document.getElementById("btnModPpto").classList.add("active");
        if(m==="grandes_eventos") document.getElementById("btnModGran").classList.add("active");

        const isList = (m==="presupuestos" || m==="grandes_eventos");
        document.getElementById("mainTable").style.display = isList ? "none" : "table";
        document.getElementById("presupuestosContainer").style.display = isList ? "block" : "none";
        
        const btn = document.getElementById("btnNuevoPrincipal");
        if(m==="eventos") btn.innerText = "+ Nuevo Evento";
        if(m==="restaurante") btn.innerText = "+ Nueva Mesa";
        if(m==="presupuestos") btn.innerText = "+ Presupuesto";
        if(m==="grandes_eventos") btn.innerText = "+ Gran Evento";
        
        render();
    }

    function render() {
        if(currentModule === "presupuestos" || currentModule === "grandes_eventos") {
            const body = document.getElementById("budgetBody");
            const isGran = currentModule === "grandes_eventos";
            
            body.innerHTML = "";
            const typeFilter = isGran ? "gran_evento" : "presupuesto";
            const filtro = document.getElementById("filtroEstado").value;

            const items = dataCache.filter(d => {
                if(d.hotel !== currentHotel || d.type !== typeFilter) return false;
                if(filtro === "todos") return d.estado !== 'anulado';
                if(filtro === "anulado") return d.estado === 'anulado';
                if(filtro === "pendiente") return d.estado !== 'confirmado' && d.estado !== 'anulado';
                return d.estado === filtro;
            });

            items.sort((a,b) => new Date(b.fechaInicio) - new Date(a.fechaInicio));

            items.forEach(d => {
                const tr = document.createElement("tr"); tr.className = "budget-row";
                let badge = `<span class="badge ${d.estado==='confirmado'?'st-confirmado':(d.estado==='anulado'?'st-anulado':'st-pendiente')}">${d.estado}</span>`;
                
                if(isGran) {
                    let pax=0, pend=0;
                    (d.participantes||[]).forEach(p => { 
                        const t = (p.pax||0)*(p.precio||0); pax+=parseInt(p.pax)||0; pend+=(t-(p.pagado||0)); 
                    });
                    tr.innerHTML = `<td>${d.fechaInicio}</td><td><b>${d.nombre}</b></td><td>${d.aforo} pax</td><td>${pax} insc.</td><td>${badge}</td><td style="text-align:right; color:${pend>0?'red':'green'}">${pend.toFixed(2)}‚Ç¨</td>`;
                } else {
                    tr.innerHTML = `<td>${d.fechaInicio}</td><td><b>${d.nombre}</b></td><td>${d.salon}</td><td>${d.ref||''}</td><td>${badge}</td><td style="text-align:right"><b>${d.total}‚Ç¨</b></td>`;
                }
                tr.onclick = () => abrirModalId(d.id);
                body.appendChild(tr);
            });
            return;
        }

        const thead = document.getElementById("tableHead");
        const tbody = document.getElementById("tableBody");
        thead.innerHTML = ""; tbody.innerHTML = "";
        
        const fBase = new Date(document.getElementById("fechaVista").value);
        let hRow = `<tr><th style="width:150px;left:0;z-index:10">ESPACIO</th>`;
        const dias = ['Dom','Lun','Mar','Mi√©','Jue','Vie','S√°b'];
        for(let i=0; i<7; i++) {
            const d = new Date(fBase); d.setDate(d.getDate()+i);
            hRow += `<th>${dias[d.getDay()]} ${d.getDate()}</th>`;
        }
        thead.innerHTML = hRow + "</tr>";

        const salones = (salonesConfig[currentHotel] || []).filter(s => s.active);
        salones.forEach(s => {
            const esRest = s.name.includes("Restaurante") || s.name.includes("Cafeter√≠a");
            if(currentModule === "restaurante" && !esRest) return;
            if(currentModule === "eventos" && esRest) return;

            const tr = document.createElement("tr");
            let row = `<td style="font-weight:bold;position:sticky;left:0;background:#fff;z-index:5">${s.name}</td>`;
            
            for(let i=0; i<7; i++) {
                const d = new Date(fBase); d.setDate(d.getDate()+i);
                const dateStr = d.toISOString().split("T")[0];
                const evts = dataCache.filter(x => x.hotel===currentHotel && x.salon===s.name && x.fechaInicio<=dateStr && x.fechaFin>=dateStr && x.estado!=='anulado');

                row += `<td>`;
                if(currentModule === "restaurante") {
                    const m = evts.filter(x => x.turno === "manana").map(x=>`<div class="mesa-card mesa-manana" onclick="abrirModalId('${x.id}')"><b>${x.hora||''}</b> ${x.nombre} (${x.paxRest})</div>`).join('');
                    const t = evts.filter(x => x.turno === "tarde").map(x=>`<div class="mesa-card mesa-tarde" onclick="abrirModalId('${x.id}')"><b>${x.hora||''}</b> ${x.nombre} (${x.paxRest})</div>`).join('');
                    row += `<div class="cell-rest"><div class="rest-zone">${m}</div><div class="rest-zone">${t}</div></div>`;
                } else {
                    const dia = evts.find(x => x.turno === "dia_completo");
                    if(dia) {
                        const cls = dia.type==='gran_evento'?'evt-gran':(dia.estado==='confirmado'?'evt-confirmado':'evt-full-day');
                        row += `<div class="split-cell" onclick="abrirModalId('${dia.id}')"><div class="evt-full-day ${cls}">${dia.nombre}</div></div>`;
                    } else {
                        const m = evts.find(x => x.turno === "manana");
                        const t = evts.find(x => x.turno === "tarde");
                        row += `<div class="split-cell">
                            <div class="split-zone" onclick="nuevoSalon('${dateStr}','${s.name}','manana')">${m ? `<div class="evt-part evt-manana ${m.estado==='confirmado'?'st-confirmado':''}" onclick="event.stopPropagation(); abrirModalId('${m.id}')">${m.nombre}</div>` : ''}</div>
                            <div class="split-zone" onclick="nuevoSalon('${dateStr}','${s.name}','tarde')">${t ? `<div class="evt-part evt-tarde ${t.estado==='confirmado'?'st-confirmado':''}" onclick="event.stopPropagation(); abrirModalId('${t.id}')">${t.nombre}</div>` : ''}</div>
                        </div>`;
                    }
                }
                row += `</td>`;
            }
            tr.innerHTML = row;
            tbody.appendChild(tr);
        });
    }

    function nuevoGeneral() { nuevo(new Date().toISOString().split("T")[0], "", ""); }
    function nuevo(fecha, salon, turno) {
        document.getElementById("dataId").value = "";
        document.getElementById("refPresupuesto").value = "";
        
        let type = "evento";
        if(currentModule==="restaurante") type="restaurante";
        if(currentModule==="presupuestos") type="presupuesto";
        if(currentModule==="grandes_eventos") type="gran_evento";
        document.getElementById("dataType").value = type;

        document.querySelectorAll("#modalFicha input").forEach(i => i.value="");
        document.querySelectorAll("#modalFicha select").forEach(i => i.selectedIndex=0);
        document.querySelectorAll("#modalFicha textarea").forEach(i => i.value="");
        document.getElementById("modalTitle").innerText = type==="presupuesto" ? "Nuevo Presupuesto" : "Nuevo Evento";
        
        document.getElementById("inpFecha").value = fecha;
        if(type==="presupuesto") { document.getElementById("inpFechaDesde").value = fecha; document.getElementById("inpFechaHasta").value = fecha; }
        
        document.getElementById("blockRestaurante").style.display = type==="restaurante" ? "block" : "none";
        document.getElementById("blockEventos").style.display = (type==="evento"||type==="presupuesto") ? "block" : "none";
        document.getElementById("blockGran").style.display = type==="gran_evento" ? "block" : "none";
        
        document.getElementById("grpFechaUnica").style.display = type==="presupuesto" ? "none" : "block";
        document.getElementById("grpRangoFechas").style.display = type==="presupuesto" ? "flex" : "none";
        document.getElementById("btnPdf").style.display = type==="presupuesto" ? "inline-flex" : "none";
        document.getElementById("btnConfirmarPpto").style.display = type==="presupuesto" ? "inline-flex" : "none";
        document.getElementById("aiToolbar").style.display = (type==="presupuesto"||type==="evento") ? "flex" : "none";
        document.getElementById("btnEmail").style.display = (type==="presupuesto") ? "inline-flex" : "none";

        document.getElementById("bodyServicios").innerHTML = "";
        document.getElementById("bodyPart").innerHTML = "";
        document.getElementById("totalAmount").innerText = "0.00";

        const sel = document.getElementById("inpSalon"); sel.innerHTML = "";
        const allS = salonesConfig[currentHotel] || [];
        if(type==="presupuesto") sel.innerHTML = "<option value='Pendiente'>-- Pendiente --</option>";
        allS.forEach(s => {
            if(!s.active) return;
            const esRest = s.name.includes("Restaurante") || s.name.includes("Cafeter√≠a");
            if(type==="restaurante" && esRest) sel.innerHTML += `<option value="${s.name}">${s.name}</option>`;
            if(type!=="restaurante" && !esRest) sel.innerHTML += `<option value="${s.name}">${s.name}</option>`;
        });
        if(salon) sel.value = salon;

        if(type==="evento" && turno) document.getElementById("inpTurnoEvento").value = turno;
        if(type==="restaurante" && turno) document.getElementById("inpTurno").value = turno;
        if(type==="gran_evento") addPart(); 
        if(type==="presupuesto") addServiceRow({date: fecha}); 

        document.getElementById("modalFicha").style.display = "flex";
    }

    function abrirModalId(id) {
        const d = dataCache.find(x => x.id === id);
        if(!d) return;
        const prevMod = currentModule;
        currentModule = d.type==="gran_evento"?"grandes_eventos":d.type==="restaurante"?"restaurante":d.type==="presupuesto"?"presupuestos":"eventos";
        nuevo(d.fechaInicio, d.salon, "");
        currentModule = prevMod;

        document.getElementById("dataId").value = d.id;
        document.getElementById("inpNombre").value = d.nombre;
        document.getElementById("modalTitle").innerText = d.nombre || "Ficha";
        document.getElementById("inpTel").value = d.tel||"";
        document.getElementById("inpEmail").value = d.email||"";
        document.getElementById("inpNotas").value = d.notas||"";
        document.getElementById("inpNotaCliente").value = d.notaCliente||"";
        
        if(d.type==="restaurante") {
            document.getElementById("inpHora").value = d.hora||"";
            document.getElementById("inpPaxRest").value = d.paxRest||"";
            document.getElementById("inpPrecioMenu").value = d.precioMenu||"";
            document.getElementById("inpTurno").value = d.turno||"manana";
            document.getElementById("inpEstadoRest").value = d.estado;
        } else if (d.type==="gran_evento") {
            document.getElementById("inpAforo").value = d.aforo||"";
            document.getElementById("inpPrcStd").value = d.precioStd||"";
            document.getElementById("inpEstadoGran").value = d.estado;
            document.getElementById("bodyPart").innerHTML="";
            (d.participantes||[]).forEach(p => addPart(p));
            calcGran();
        } else {
            document.getElementById("inpFechaDesde").value = d.fechaInicio;
            document.getElementById("inpFechaHasta").value = d.fechaFin;
            document.getElementById("inpTurnoEvento").value = d.turno||"dia_completo";
            document.getElementById("inpMontaje").value = d.montaje;
            document.getElementById("inpPaxA").value = d.paxA;
            document.getElementById("inpPaxN").value = d.paxN;
            document.getElementById("inpHoraInicio").value = d.horaInicio||"";
            document.getElementById("inpHoraFin").value = d.horaFin||"";
            document.getElementById("inpEstadoEvento").value = d.estado;
            document.getElementById("refPresupuesto").value = d.ref||"";
            document.getElementById("bodyServicios").innerHTML = "";
            (d.servicios||[]).forEach(s => addServiceRow(s));
            calcTotal();
        }
    }

    // --- INPUTS PRECIO & CALCULOS (CORREGIDO: Limpiar ‚Ç¨) ---
    function addServiceRow(d={}) {
        const tr = document.createElement("tr");
        const f = d.date || document.getElementById("inpFecha").value;
        let displayPrice = "";
        if(d.price && parseFloat(d.price)>0) displayPrice = parseFloat(d.price).toFixed(2) + " ‚Ç¨";

        tr.innerHTML = `<td><input type="date" class="svc-input s-date" value="${f}"></td>
                        <td><input class="svc-input s-desc" value="${d.desc||''}" style="text-align:left" placeholder="Concepto"></td>
                        <td><input type="number" class="svc-input s-uds" value="${d.uds||1}" oninput="calcTotal()"></td>
                        <td><input type="text" class="svc-input s-price" value="${displayPrice}" placeholder="0.00 ‚Ç¨" onfocus="this.value=''" onblur="formatPrice(this); calcTotal()" oninput="calcTotal()"></td>
                        <td><input class="svc-input s-tot" readonly style="font-weight:bold;"></td>
                        <td class="btn-del-row" style="text-align:center;cursor:pointer;color:red;" onclick="this.parentElement.remove();calcTotal()">‚úï</td>`;
        document.getElementById("bodyServicios").appendChild(tr);
        calcTotal();
    }
    function formatPrice(el) {
        let val = el.value.replace(',','.').replace(' ‚Ç¨','').replace('‚Ç¨','');
        if(val && !isNaN(val) && parseFloat(val)!==0) el.value = parseFloat(val).toFixed(2) + " ‚Ç¨";
        else if(!val || parseFloat(val)===0) el.value = "";
    }
    function calcTotal() {
        let t=0; 
        document.querySelectorAll("#bodyServicios tr").forEach(tr => {
            const uds = parseFloat(tr.querySelector(".s-uds").value)||0;
            // L√≥gica clave: Limpiar ‚Ç¨ antes de multiplicar
            const rawP = tr.querySelector(".s-price").value.replace(' ‚Ç¨','').replace('‚Ç¨','').replace(',','.');
            const price = parseFloat(rawP)||0;
            const tot = uds * price;
            tr.querySelector(".s-tot").value = tot.toFixed(2) + " ‚Ç¨";
            t += tot;
        });
        document.getElementById("totalAmount").innerText = t.toFixed(2);
    }

    function addPart(d={}) {
        const tr = document.createElement("tr");
        const std = document.getElementById("inpPrcStd").value || 0;
        tr.innerHTML = `<td><input class="svc-input p-mesa" value="${d.mesa||''}"></td><td><input class="svc-input p-nom" value="${d.nombre||''}" style="text-align:left"></td><td><input type="number" class="svc-input p-pax" value="${d.pax||1}" oninput="calcGran()"></td><td><input type="number" class="svc-input p-prc" value="${d.precio||std}" oninput="calcGran()"></td><td><input type="number" class="svc-input p-pag" value="${d.pagado||0}" oninput="calcGran()" style="color:green; font-weight:bold;"></td><td style="text-align:center;cursor:pointer;color:red;" onclick="this.parentElement.remove();calcGran()">‚úï</td>`;
        document.getElementById("bodyPart").appendChild(tr);
        calcGran();
    }
    function calcGran() {
        let pax=0, tot=0, pag=0;
        document.querySelectorAll("#bodyPart tr").forEach(tr => {
            const p = parseFloat(tr.querySelector(".p-pax").value)||0;
            const pr = parseFloat(tr.querySelector(".p-prc").value)||0;
            const pg = parseFloat(tr.querySelector(".p-pag").value)||0;
            pax+=p; tot+=(p*pr); pag+=pg;
        });
        document.getElementById("gPax").innerText = pax;
        document.getElementById("gTot").innerText = tot.toFixed(2);
        document.getElementById("gPag").innerText = pag.toFixed(2);
        document.getElementById("gPend").innerText = (tot-pag).toFixed(2);
    }
    function aplicarStd() {
        if(confirm("¬øAplicar a todos?")) { const v = document.getElementById("inpPrcStd").value; document.querySelectorAll(".p-prc").forEach(i=>{i.value=v}); calcGran(); }
    }

    async function guardarFicha() {
        const nombre = document.getElementById("inpNombre").value;
        if (!nombre || nombre.trim() === "") { alert("‚ö†Ô∏è Escribe un Nombre"); return; }

        try {
            const id = document.getElementById("dataId").value;
            const type = document.getElementById("dataType").value;
            
            const data = {
                hotel: currentHotel, type, nombre,
                tel: document.getElementById("inpTel").value,
                email: document.getElementById("inpEmail").value,
                salon: document.getElementById("inpSalon").value,
                notas: document.getElementById("inpNotas").value,
                notaCliente: document.getElementById("inpNotaCliente").value,
                updatedAt: new Date().toISOString() 
            };

            if (type === "restaurante") {
                data.hora = document.getElementById("inpHora").value;
                data.paxRest = document.getElementById("inpPaxRest").value;
                data.precioMenu = document.getElementById("inpPrecioMenu").value;
                data.turno = document.getElementById("inpTurno").value;
                data.estado = document.getElementById("inpEstadoRest").value;
                data.fechaInicio = document.getElementById("inpFecha").value;
                data.fechaFin = data.fechaInicio;
            } else if (type === "gran_evento") {
                data.fechaInicio = document.getElementById("inpFecha").value;
                data.fechaFin = data.fechaInicio;
                data.aforo = document.getElementById("inpAforo").value;
                data.precioStd = document.getElementById("inpPrcStd").value;
                data.estado = document.getElementById("inpEstadoGran").value;
                data.participantes = [];
                document.querySelectorAll("#bodyPart tr").forEach(tr => {
                    data.participantes.push({
                        mesa: tr.querySelector(".p-mesa").value, nombre: tr.querySelector(".p-nom").value,
                        pax: tr.querySelector(".p-pax").value, precio: tr.querySelector(".p-prc").value, pagado: tr.querySelector(".p-pag").value
                    });
                });
            } else {
                if(type==="presupuesto") {
                    data.fechaInicio = document.getElementById("inpFechaDesde").value;
                    data.fechaFin = document.getElementById("inpFechaHasta").value;
                    data.ref = document.getElementById("refPresupuesto").value || "PRE-"+Date.now();
                } else {
                    data.fechaInicio = document.getElementById("inpFecha").value;
                    data.fechaFin = data.fechaInicio;
                }
                if(!data.fechaInicio) data.fechaInicio = new Date().toISOString().split("T")[0]; 

                data.turno = document.getElementById("inpTurnoEvento").value;
                data.montaje = document.getElementById("inpMontaje").value;
                data.paxA = document.getElementById("inpPaxA").value;
                data.paxN = document.getElementById("inpPaxN").value;
                data.horaInicio = document.getElementById("inpHoraInicio").value;
                data.horaFin = document.getElementById("inpHoraFin").value;
                data.estado = document.getElementById("inpEstadoEvento").value;
                data.total = document.getElementById("totalAmount").innerText;
                data.servicios = [];
                document.querySelectorAll("#bodyServicios tr").forEach(tr => {
                    // GUARDAR LIMPIO
                    const rawP = tr.querySelector(".s-price").value.replace(' ‚Ç¨','').replace('‚Ç¨','').replace(',','.');
                    data.servicios.push({date:tr.querySelector(".s-date").value, desc:tr.querySelector(".s-desc").value, uds:tr.querySelector(".s-uds").value, price:rawP});
                });
            }

            if (id) await db.collection("master_data").doc(id).update(data);
            else await db.collection("master_data").add(data);

            if (type === "presupuesto" && data.estado === "confirmado") sincronizarEventosVinculados(id || "NEW", data);

            alert("‚úÖ Guardado correctamente");
            document.getElementById("modalFicha").style.display = "none";
            
        } catch (e) {
            console.error(e);
            alert("‚ùå ERROR AL GUARDAR: " + e.message);
        }
    }

    async function confirmarPresupuesto() {
        const salon = document.getElementById("inpSalon").value;
        if(!salon || salon==="Pendiente") return alert("Selecciona un sal√≥n definitivo");
        document.getElementById("inpEstadoEvento").value = "confirmado";
        await guardarFicha();
    }

    async function sincronizarEventosVinculados(idRef, data) {
        if(!idRef) return;
        const h = salonesConfig.horarios || { almIni:"13:00", almFin:"16:00", cenaIni:"20:30", cenaFin:"23:00", corte:"18:00" };
        const toMin = s => {const [hh,mm]=s.split(":").map(Number); return (hh*60)+mm;}
        
        const d1 = new Date(data.fechaInicio); const d2 = new Date(data.fechaFin);
        const diff = (d2-d1)/(1000*60*60*24);
        const batch = db.batch();
        for(let i=0; i<=diff; i++) {
            const d = new Date(d1); d.setDate(d.getDate()+i);
            const dateStr = d.toISOString().split("T")[0];
            const isRest = data.salon.includes("Restaurante") || data.salon.includes("Cafeter√≠a");
            let newType = isRest ? "restaurante" : "evento";
            let turno = "manana"; let hora = "14:00";
            let pax = data.paxA; let precio = 0;
            if(isRest) {
                const horaP = data.horaInicio || "14:00";
                if(toMin(horaP) >= toMin(h.corte)) { turno="tarde"; hora="21:00"; }
                let uds=0, prc=0;
                (data.servicios||[]).forEach(s => { 
                    if(s.date === dateStr) { uds += parseInt(s.uds)||0; prc += parseFloat(s.price)||0; }
                });
                if(uds>0) pax = uds;
                if(prc>0) precio = prc;
            } else { turno = "dia_completo"; }

            const ref = db.collection("master_data").doc();
            batch.set(ref, {
                hotel: currentHotel, type: newType, nombre: data.nombre,
                salon: data.salon, fechaInicio: dateStr, fechaFin: dateStr,
                estado: "confirmado", refPresupuesto: idRef,
                paxA: pax, paxRest: pax, turno: turno, hora: hora, precioMenu: precio
            });
        }
        await batch.commit();
        alert("‚úÖ Sincronizado con Agenda");
    }

    function anularFicha() {
        const id = document.getElementById("dataId").value;
        if(id && confirm("¬øAnular?")) {
            db.collection("master_data").doc(id).update({estado:"anulado"});
            document.getElementById("modalFicha").style.display = "none";
        }
    }

    async function callGemini(prompt) {
        try {
            const r = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key="+apiKey, {
                method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
            });
            const d = await r.json();
            return d.candidates?.[0]?.content?.parts?.[0]?.text;
        } catch(e) { alert("Error IA"); return null; }
    }
    async function generarMenuIA() {
        const p = `Crea un men√∫ de 3 platos para un evento tipo "${document.getElementById("inpNombre").value}". Solo nombres de platos.`;
        const r = await callGemini(p);
        if(r) addServiceRow({desc: r.replace(/\n/g, " | "), uds: document.getElementById("inpPaxA").value, price:0, date: document.getElementById("inpFecha").value});
    }
    async function redactarEmailIA() {
        const p = `Redacta email para cliente ${document.getElementById("inpNombre").value} enviando presupuesto de ${document.getElementById("totalAmount").innerText}‚Ç¨. Tono formal.`;
        const r = await callGemini(p);
        if(r) { document.getElementById("aiOutput").value=r; document.getElementById("aiResponseModal").style.display="flex"; }
    }
    async function mejorarNotaIA() {
        const p = `Mejora este texto para cliente: ${document.getElementById("inpNotaCliente").value}`;
        const r = await callGemini(p);
        if(r) document.getElementById("inpNotaCliente").value = r;
    }
    function checklistIA() { alert("Checklist generado (simulado)"); }
    function auditarIA() { alert("Auditor√≠a (simulada)"); }
    function copiarAI() { document.getElementById("aiOutput").select(); document.execCommand("copy"); document.getElementById("aiResponseModal").style.display="none"; }
    
    function imprimirPDF() {
        alert("Funci√≥n PDF Lista.");
    }

</script>
</body>
</html>